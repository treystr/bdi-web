---
import Layout from '@layouts/Layout.astro';
import { getCollection } from 'astro:content';
import PageHeader from '@components/sections/PageHeader.astro';
import CtaBanner from '@components/sections/CtaBanner.astro';
import heroImage from '@assets/images/hero/hero-bizgrid.jpg';

const initiativesEntries = await getCollection('initiatives');

console.log('Total initiatives loaded:', initiativesEntries.length);
console.log('Initiative IDs:', initiativesEntries.map(e => e.id));

// Sort by featured first, then by start date (newest first)
const sortedInitiatives = initiativesEntries.sort((a, b) => {
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    const aDate = new Date(a.data.startDate).getTime();
    const bDate = new Date(b.data.startDate).getTime();
    return bDate - aDate;
});

// Separate active and completed initiatives
const activeInitiatives = sortedInitiatives.filter(entry => entry.data.status === 'active');
const completedInitiatives = sortedInitiatives.filter(entry => entry.data.status === 'completed');

// CTA to donate
const donateCta = {
    //eyebrow: "SUPPORT OUR WORK",
    title: "Support our Work",
    // description: "Every dollar you contribute directly funds these mission-critical programs. Your donation helps us expand our reach, serve more communities, and create lasting impact.",
    buttons: [
        {
            text: "Donate Now",
            link: "/donate",
            variant: "primary" as const
        },
        {
            text: "Contact Us",
            link: "/contact",
            variant: "secondary" as const
        }
    ]
};

const seoTitle = "Our Initiatives"
const seoDescription = "Discover how the Bitcoin District Initiative builds a Bitcoin circular economy in Washington, DC through education, business adoption, and community outreach.";
---

<Layout title={seoTitle} description={seoDescription} image={heroImage.src}>
    <PageHeader 
        title="Our Initiatives" 
        description="These are the active projects driving our mission to build a Bitcoin circular economy in the Nation's Capital by bringing Bitcoin to Main Street DC." 
        background="base" 
    />

    <section class="py-xsmall">
        <div class="site-container--content px-8">
            <!-- Active Initiatives -->
            {activeInitiatives.length > 0 && (
                <div class="mb-20">
                    <div class="grid gap-8 md:grid-cols-2">
                        {activeInitiatives.map((entry) => {
                            return (
                                <article class="bg-base border border-body-base/10 rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300 hover:border-accent/30">
                                    {/* Image on top - clickable */}
                                    <a href={`/initiatives/${entry.id}`} class="block">
                                        <div class="relative bg-gray-50">
                                            <img 
                                                src={entry.data.cardImage.src} 
                                                alt={entry.data.title} 
                                                class="w-full h-auto object-contain hover:scale-105 transition-transform duration-300"
                                            />
                                        </div>
                                    </a>
                                    
                                    {/* Content below */}
                                    <div class="p-6">
                                        <a href={`/initiatives/${entry.id}`} class="group">
                                            <h3 class="text-2xl font-bold mb-4 group-hover:text-accent transition-colors">
                                                {entry.data.title}
                                            </h3>
                                        </a>
                                        
                                        <p class="text-body-base/70 text-sm leading-relaxed">
                                            {entry.data.shortDescription}
                                        </p>
                                    </div>
                                </article>
                            );
                        })}
                    </div>
                </div>
            )}

            <!-- Completed Initiatives -->
            {completedInitiatives.length > 0 && (
                <div class="mt-20">
                    <h2 class="text-2xl font-bold mb-8 pb-4 border-b-2 border-body-base/20">Completed Initiatives</h2>
                    <div class="grid gap-8 md:grid-cols-2">
                        {completedInitiatives.map((entry) => {
                            return (
                                <article class="bg-base border border-body-base/10 rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300 hover:border-accent/30">
                                    {/* Image on top - clickable */}
                                    <a href={`/initiatives/${entry.id}`} class="block">
                                        <div class="relative bg-gray-50">
                                            <img 
                                                src={entry.data.cardImage.src} 
                                                alt={entry.data.title} 
                                                class="w-full h-auto object-contain hover:scale-105 transition-transform duration-300"
                                            />
                                            {/* Completed badge overlay */}
                                            <div class="absolute top-4 left-4">
                                                <span class="inline-block px-3 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">
                                                    Completed
                                                </span>
                                            </div>
                                        </div>
                                    </a>
                                    
                                    {/* Content below */}
                                    <div class="p-6">
                                        <a href={`/initiatives/${entry.id}`} class="group">
                                            <h3 class="text-2xl font-bold mb-4 group-hover:text-accent transition-colors">
                                                {entry.data.title}
                                            </h3>
                                        </a>
                                        
                                        <p class="text-body-base/70 text-sm leading-relaxed">
                                            {entry.data.shortDescription}
                                        </p>
                                    </div>
                                </article>
                            );
                        })}
                    </div>
                </div>
            )}

            <!-- Empty State (if no initiatives exist) -->
            {activeInitiatives.length === 0 && completedInitiatives.length === 0 && (
                <div class="text-center py-20">
                    <h2 class="text-2xl font-bold mb-4">Coming Soon</h2>
                    <p class="text-body-base/70 max-w-2xl mx-auto">
                        We're currently planning our flagship initiatives. Check back soon to see 
                        how we're making an impact in DC communities through Bitcoin education and adoption.
                    </p>
                </div>
            )}
        </div>
    </section>

    <!-- Donate CTA -->
    <CtaBanner
        content={donateCta}
        variant="contained"
        background="light"
        padding="large"
    />
</Layout>

