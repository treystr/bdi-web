---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import PageHeader from '../../components/sections/PageHeader.astro';

export async function getStaticPaths() {
    const legalEntries = await getCollection('legal');
    return legalEntries.map((entry) => ({
        params: { slug: entry.id },
        props: { entry },
    }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Use SEO data from frontmatter if available, fallback to regular entry data
const seoTitle = entry.data.seo?.title || entry.data.title;
const seoDescription = entry.data.seo?.description || '';

// Format the last updated date
const formattedDate = new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    timeZone: 'UTC'
}).format(entry.data.lastUpdated);

const pageHeaderContent = {
    title: entry.data.title,
    description: ''
};
---

<Layout title={seoTitle} description={seoDescription}>
    <PageHeader title={pageHeaderContent.title} description={pageHeaderContent.description} background="base" />

    <article class="site-container--article mx-auto px-8 prose pb-base">
        <div class="mt-12 mb-8">
            <p class="text-sm text-body-base/80">Last updated: {formattedDate}</p>
        </div>

        <Content />
    </article>
</Layout>
