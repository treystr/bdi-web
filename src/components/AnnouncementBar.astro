---
import { announcementBarSetting } from '@data/config';

interface Props {
    currentPath: string;
}

const { currentPath } = Astro.props;

// Check if announcement bar should be shown on this page
const shouldShow = () => {
    if (!announcementBarSetting.enabled) return false;
    
    // If showOnPages is empty, show on all pages
    if (announcementBarSetting.showOnPages.length === 0) return true;
    
    // Check if current path matches any of the configured pages
    return announcementBarSetting.showOnPages.some(page => {
        // Normalize paths for comparison
        const normalizedPage = page === '/' ? '/' : page.replace(/\/$/, '');
        const normalizedCurrent = currentPath === '/' ? '/' : currentPath.replace(/\/$/, '');
        return normalizedCurrent === normalizedPage;
    });
};

const showBar = shouldShow();
---

{showBar && (
    <div 
        class:list={[
            'announcement-bar',
            'fixed top-0 left-0 right-0 z-[60] w-full',
            announcementBarSetting.backgroundColor
        ]}
    >
        <a 
            href={announcementBarSetting.link}
            class:list={[
                'block w-full py-2 px-4 text-center hover:opacity-90 transition-opacity duration-200',
                announcementBarSetting.textColor
            ]}
        >
            <span class="announcement-text font-medium">
                {announcementBarSetting.text}
            </span>
        </a>
    </div>
)}

<style>
    .announcement-bar {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .announcement-bar a {
        color: white;
    }
    
    /* Base font size for desktop */
    .announcement-text {
        font-size: 0.875rem; /* 14px */
        line-height: 1.5;
        color: inherit;
    }
    
    /* Smaller font size for tablets */
    @media (max-width: 1024px) {
        .announcement-text {
            font-size: 0.8125rem; /* 13px */
        }
    }
    
    /* Even smaller for mobile to prevent line breaks */
    @media (max-width: 640px) {
        .announcement-text {
            font-size: 0.75rem; /* 12px */
        }
    }
    
    /* Extra small screens */
    @media (max-width: 380px) {
        .announcement-text {
            font-size: 0.6875rem; /* 11px */
        }
    }
</style>

