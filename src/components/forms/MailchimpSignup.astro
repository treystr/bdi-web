---
import Input from '@components/ui/form/Input.astro';
import Button from '@components/ui/Button.astro';

interface Props {
    size?: 'small' | 'medium' | 'large';
    showLabels?: boolean;
    background?: 'base' | 'light' | 'dark';
}

const { 
    size = 'medium', 
    showLabels = true,
    background = 'base'
} = Astro.props;

// Mailchimp form configuration
const mailchimpAction = 'https://bitcoindistrictinitiative.us11.list-manage.com/subscribe/post?u=15a85000da45e77900cfe72fa&id=a19e080d89&f_id=007099e0f0';
const honeypotFieldName = 'b_15a85000da45e77900cfe72fa_a19e080d89';

// Size configuration
const sizeConfig = {
    small: { maxWidth: '440px', layout: 'vertical' },
    medium: { maxWidth: '600px', layout: 'grid' },
    large: { maxWidth: '800px', layout: 'grid' }
};

const config = sizeConfig[size];
const isSmall = size === 'small';
---

<div class="mailchimp-signup" style={`max-width: ${config.maxWidth}; margin: 0 auto; width: 100%`}>
    <form 
        action={mailchimpAction}
        method="post"
        id="mc-embedded-subscribe-form"
        name="mc-embedded-subscribe-form"
        class="validate"
        target="_blank"
        novalidate
    >
        <div id="mc_embed_signup_scroll">
            {isSmall && (
                <>
                    <!-- Small/Footer Layout: Email only with button inside field -->
                    <div class="footer-signup-wrapper">
                        <input
                            type="email"
                            id="mce-EMAIL"
                            name="EMAIL"
                            placeholder="Sign up for the latest news & events!"
                            required
                            autocomplete="email"
                            inputmode="email"
                            class="footer-signup-input"
                        />
                        <button
                            type="submit"
                            class="footer-signup-button"
                        >
                            Subscribe
                        </button>
                    </div>
                    <!-- Hidden Mailchimp tags field -->
                    <div hidden="">
                        <input type="hidden" name="tags" value="9273796" />
                    </div>
                    <!-- Honeypot field (hidden from users) -->
                    <div style="position: absolute; left: -5000px;" aria-hidden="true">
                        <input type="text" name={honeypotFieldName} tabindex="-1" value="" />
                    </div>
                    <!-- Response messages -->
                    <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display: none;"></div>
                        <div class="response" id="mce-success-response" style="display: none;"></div>
                    </div>
                </>
            )}
            {!isSmall && (
                <!-- Medium/Large Layout: Full form -->
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <Input
                            type="email"
                            id="mce-EMAIL"
                            name="EMAIL"
                            label="Email Address"
                            placeholder="email@example.com"
                            required
                            background={background}
                            autocomplete="email"
                            inputmode="email"
                        />
                        <Input
                            type="text"
                            id="mce-FNAME"
                            name="FNAME"
                            label="First Name"
                            placeholder="John"
                            background={background}
                            autocomplete="given-name"
                        />
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <Input
                            type="text"
                            id="mce-LNAME"
                            name="LNAME"
                            label="Last Name"
                            placeholder="Doe"
                            background={background}
                            autocomplete="family-name"
                        />
                        <Input
                            type="text"
                            id="mce-COMPANY"
                            name="COMPANY"
                            label="Company"
                            placeholder="Your company"
                            background={background}
                            autocomplete="organization"
                        />
                    </div>

                    <!-- Hidden Mailchimp tags field -->
                    <div hidden="">
                        <input type="hidden" name="tags" value="9273796" />
                    </div>

                    <!-- Honeypot field (hidden from users) -->
                    <div style="position: absolute; left: -5000px;" aria-hidden="true">
                        <input type="text" name={honeypotFieldName} tabindex="-1" value="" />
                    </div>

                    <!-- Response messages -->
                    <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display: none;"></div>
                        <div class="response" id="mce-success-response" style="display: none;"></div>
                    </div>

                    <div class="mt-6">
                        <Button type="submit" variant="primary" size="lg" class="w-full md:w-auto">
                            Subscribe
                        </Button>
                    </div>
                </div>
            )}
        </div>
    </form>
</div>

<script>
    // Mailchimp form validation script
    (function() {
        window.fnames = new Array();
        window.ftypes = new Array();
        fnames[0]='EMAIL';
        ftypes[0]='email';
        fnames[1]='FNAME';
        ftypes[1]='text';
        fnames[2]='LNAME';
        ftypes[2]='text';
        fnames[6]='COMPANY';
        ftypes[6]='text';
    })();
</script>

<script src="https://s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script>
<script>
    (function($) {
        window.fnames = new Array();
        window.ftypes = new Array();
        fnames[0]='EMAIL';
        ftypes[0]='email';
        fnames[1]='FNAME';
        ftypes[1]='text';
        fnames[2]='LNAME';
        ftypes[2]='text';
        fnames[6]='COMPANY';
        ftypes[6]='text';
    }(jQuery));
    var $mcj = jQuery.noConflict(true);
</script>

<style>
    .mailchimp-signup {
        width: 100%;
    }

    /* Hide labels and asterisk for small footer form when label is empty */
    .mailchimp-signup .form-group label:empty,
    .mailchimp-signup .form-group label:has(span.text-red-500:only-child) {
        display: none;
    }

    /* Ensure input background is white for footer form */
    .mailchimp-signup .form-group input.bg-white {
        background-color: white !important;
    }

    /* Response message styling */
    #mce-error-response,
    #mce-success-response {
        padding: 0.75rem 1rem;
        margin-top: 1rem;
        border-radius: 0.5rem;
        font-size: 0.875rem;
    }

    #mce-error-response {
        background-color: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
    }

    #mce-success-response {
        background-color: #d1fae5;
        color: #065f46;
        border: 1px solid #a7f3d0;
    }

    /* Footer signup form - button inside input field */
    .footer-signup-wrapper {
        position: relative;
        width: 100%;
        max-width: 440px;
        margin: 0 auto;
    }

    .footer-signup-input {
        width: 100%;
        height: 40px;
        padding: 0 120px 0 16px;
        background-color: #f3f4f6;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        color: #1f2937;
        font-size: 14px;
        outline: none;
        transition: all 0.2s ease;
    }

    .footer-signup-input::placeholder {
        color: #6b7280;
        font-size: 14px;
    }

    .footer-signup-input:focus {
        border-color: var(--color-primary, #f7931a);
        background-color: white;
    }

    .footer-signup-button {
        position: absolute;
        right: 4px;
        top: 50%;
        transform: translateY(-50%);
        height: 32px;
        padding: 0 16px;
        background-color: var(--color-primary, #f7931a);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .footer-signup-button:hover {
        background-color: var(--color-primary-light, #ffa733);
    }

    .footer-signup-button:active {
        transform: translateY(-50%) scale(0.98);
    }

    /* Small form adjustments */
    @media (max-width: 640px) {
        .mailchimp-signup .flex-col {
            gap: 0.75rem;
        }
    }
</style>

